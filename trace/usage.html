
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="Python">
  <head>
    <meta charset="utf-8" />
    <title>OpenCensus Trace for Python &#8212; OPENCENSUS 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Documentation" href="api/index.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="opencensus-trace-for-python">
<h1>OpenCensus Trace for Python<a class="headerlink" href="#opencensus-trace-for-python" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://gitter.im/census-instrumentation/lobby?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img alt="gitter" src="https://badges.gitter.im/census-instrumentation/lobby.svg" /></a>
<a class="reference external" href="https://circleci.com/gh/census-instrumentation/opencensus-python"><img alt="circleci" src="https://circleci.com/gh/census-instrumentation/opencensus-python.svg?style=shield" /></a>
<a class="reference external" href="https://pypi.org/project/opencensus/"><img alt="pypi" src="https://badge.fury.io/py/opencensus.svg" /></a></p>
<p><a class="reference external" href="https://github.com/census-instrumentation">OpenCensus</a> for Python. OpenCensus provides a framework to measure a
server's resource usage and collect performance stats. This repository
contains Python related utilities and supporting software needed by
OpenCensus.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://opencensus.io/api/python/trace/usage.html">API Documentation</a></p></li>
</ul>
<div class="section" id="tracing">
<h2>Tracing<a class="headerlink" href="#tracing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installation-basic-usage">
<h3>Installation &amp; basic usage<a class="headerlink" href="#installation-basic-usage" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Install the opencensus package using <a class="reference external" href="https://pip.pypa.io">pip</a> or <a class="reference external" href="https://docs.pipenv.org/">pipenv</a>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">opencensus</span>
<span class="n">pipenv</span> <span class="n">install</span> <span class="n">opencensus</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Initialize a tracer for your application:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">opencensus.trace.tracer</span> <span class="kn">import</span> <span class="n">Tracer</span>
<span class="kn">from</span> <span class="nn">opencensus.trace.samplers</span> <span class="kn">import</span> <span class="n">AlwaysOnSampler</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">Tracer</span><span class="p">(</span><span class="n">sampler</span><span class="o">=</span><span class="n">AlwaysOnSampler</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Initialize a view_manager and a stats_recorder for your application:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">opencensus.stats</span> <span class="kn">import</span> <span class="n">stats</span> <span class="k">as</span> <span class="n">stats_module</span>

<span class="n">stats</span> <span class="o">=</span> <span class="n">stats_module</span><span class="o">.</span><span class="n">stats</span>
<span class="n">view_manager</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">view_manager</span>
<span class="n">stats_recorder</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">stats_recorder</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>You can collect traces using the <code class="docutils literal notranslate"><span class="pre">Tracer</span></code> <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#context-managers">context manager</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">opencensus.trace.tracer</span> <span class="kn">import</span> <span class="n">Tracer</span>
<span class="kn">from</span> <span class="nn">opencensus.trace.samplers</span> <span class="kn">import</span> <span class="n">AlwaysOnSampler</span>

<span class="c1"># Initialize a tracer, by default using the `PrintExporter`</span>
<span class="n">tracer</span> <span class="o">=</span> <span class="n">Tracer</span><span class="p">(</span><span class="n">sampler</span><span class="o">=</span><span class="n">AlwaysOnSampler</span><span class="p">())</span>

<span class="c1"># Example for creating nested spans</span>
<span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;span1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">span1</span><span class="p">:</span>
    <span class="n">do_something_to_trace</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">span1</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;span1_child1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">span1_child1</span><span class="p">:</span>
        <span class="n">do_something_to_trace</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">span1</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;span1_child2&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">span1_child2</span><span class="p">:</span>
        <span class="n">do_something_to_trace</span><span class="p">()</span>
<span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;span2&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">span2</span><span class="p">:</span>
    <span class="n">do_something_to_trace</span><span class="p">()</span>
</pre></div>
</div>
<p>OpenCensus will collect everything within the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement as a single span.</p>
<p>Alternatively, you can explicitly start and end a span:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">opencensus.trace.tracer</span> <span class="kn">import</span> <span class="n">Tracer</span>
<span class="kn">from</span> <span class="nn">opencensus.trace.samplers</span> <span class="kn">import</span> <span class="n">AlwaysOnSampler</span>

<span class="c1"># Initialize a tracer, by default using the `PrintExporter`</span>
<span class="n">tracer</span> <span class="o">=</span> <span class="n">Tracer</span><span class="p">(</span><span class="n">sampler</span><span class="o">=</span><span class="n">AlwaysOnSampler</span><span class="p">())</span>

<span class="n">tracer</span><span class="o">.</span><span class="n">start_span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;span1&#39;</span><span class="p">)</span>
<span class="n">do_something_to_trace</span><span class="p">()</span>
<span class="n">tracer</span><span class="o">.</span><span class="n">end_span</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="customization">
<h3>Customization<a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h3>
<p>There are several things you can customize in OpenCensus:</p>
<ul class="simple">
<li><p><strong>Blacklist</strong>, which excludes certain hosts and paths from being tracked.
By default, the health check path for the App Engine flexible environment is
not tracked, you can turn it on by excluding it from the blacklist setting.</p></li>
<li><p><strong>Exporter</strong>, which sends the traces.
By default, the traces are printed to stdout in JSON format. You can choose
different exporters to send the traces to. There are three built-in exporters,
which are <code class="docutils literal notranslate"><span class="pre">PrintExporter</span></code>, <code class="docutils literal notranslate"><span class="pre">FileExporter</span></code> and <code class="docutils literal notranslate"><span class="pre">LoggingExporter</span></code>, the
other exporters are provided as <a class="reference external" href="#trace-exporter">extensions</a>.</p></li>
<li><p><strong>Sampler</strong>, which determines how traces are sampled.
The default sampler is the <code class="docutils literal notranslate"><span class="pre">ProbabilitySampler</span></code>, which samples (i.e.
enables tracing for) a percentage of all requests. Sampling is deterministic
according to the trace ID. To force sampling for all requests, or to prevent
any request from being sampled, see <code class="docutils literal notranslate"><span class="pre">AlwaysOnSampler</span></code> and
<code class="docutils literal notranslate"><span class="pre">AlwaysOffSampler</span></code>.</p></li>
<li><p><strong>Propagator</strong>, which serializes and deserializes the
<code class="docutils literal notranslate"><span class="pre">SpanContext</span></code> and its headers. The default propagator is
<code class="docutils literal notranslate"><span class="pre">TraceContextPropagator</span></code>, other propagators include
<code class="docutils literal notranslate"><span class="pre">BinaryFormatPropagator</span></code>, <code class="docutils literal notranslate"><span class="pre">GoogleCloudFormatPropagator</span></code> and
<code class="docutils literal notranslate"><span class="pre">TextFormatPropagator</span></code>.</p></li>
</ul>
<p>You can customize while initializing a tracer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">opencensus.trace</span> <span class="kn">import</span> <span class="n">config_integration</span>
<span class="kn">from</span> <span class="nn">opencensus.trace</span> <span class="kn">import</span> <span class="n">file_exporter</span>
<span class="kn">from</span> <span class="nn">opencensus.trace</span> <span class="kn">import</span> <span class="n">tracer</span> <span class="k">as</span> <span class="n">tracer_module</span>
<span class="kn">from</span> <span class="nn">opencensus.trace.propagation</span> <span class="kn">import</span> <span class="n">google_cloud_format</span>
<span class="kn">from</span> <span class="nn">opencensus.trace.samplers</span> <span class="kn">import</span> <span class="n">ProbabilitySampler</span>

<span class="n">config_integration</span><span class="o">.</span><span class="n">trace_integrations</span><span class="p">([</span><span class="s1">&#39;httplib&#39;</span><span class="p">])</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">tracer_module</span><span class="o">.</span><span class="n">Tracer</span><span class="p">(</span>
    <span class="n">exporter</span><span class="o">=</span><span class="n">file_exporter</span><span class="o">.</span><span class="n">FileExporter</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;traces&#39;</span><span class="p">),</span>
    <span class="n">propagator</span><span class="o">=</span><span class="n">google_cloud_format</span><span class="o">.</span><span class="n">GoogleCloudFormatPropagator</span><span class="p">(),</span>
    <span class="n">sampler</span><span class="o">=</span><span class="n">ProbabilitySampler</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;parent&#39;</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">span</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:5000&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use a configuration file for Flask/Django/Pyramid. For more
information, please read the
<a class="reference external" href="#integration">individual integration documentation</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;OPENCENSUS&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;TRACE&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;BLACKLIST_HOSTNAMES&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">],</span>
        <span class="s1">&#39;BLACKLIST_PATHS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;_ah/health&#39;</span><span class="p">],</span>
        <span class="s1">&#39;SAMPLER&#39;</span><span class="p">:</span> <span class="s1">&#39;opencensus.trace.samplers.ProbabilitySampler(rate=1)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;EXPORTER&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;opencensus.ext.ocagent.trace_exporter.TraceExporter(</span>
<span class="s1">            service_name=&#39;foobar&#39;,</span>
<span class="s1">        )&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PROPAGATOR&#39;</span><span class="p">:</span> <span class="s1">&#39;opencensus.trace.propagation.google_cloud_format.GoogleCloudFormatPropagator()&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extensions">
<h2>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="integration">
<h3>Integration<a class="headerlink" href="#integration" title="Permalink to this headline">¶</a></h3>
<p>OpenCensus supports integration with popular web frameworks, client libraries and built-in libraries.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-django">Django</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-flask">Flask</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-gevent">gevent</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-google-cloud-clientlibs">Google Cloud Client Libraries</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-grpc">gRPC</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-httplib">httplib</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-logging">logging</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-mysql">MySQL</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-postgresql">PostgreSQL</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-pymongo">pymongo</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-pymysql">PyMySQL</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-pyramid">Pyramid</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-requests">requests</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-sqlalchemy">SQLAlchemy</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-threading">threading</a></p></li>
</ul>
</div>
<div class="section" id="trace-exporter">
<h3>Trace Exporter<a class="headerlink" href="#trace-exporter" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-azure">Azure</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-jaeger">Jaeger</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-ocagent">OCAgent</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-stackdriver">Stackdriver</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-zipkin">Zipkin</a></p></li>
</ul>
</div>
<div class="section" id="stats-exporter">
<h3>Stats Exporter<a class="headerlink" href="#stats-exporter" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-ocagent">OCAgent</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-prometheus">Prometheus</a></p></li>
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-stackdriver">Stackdriver</a></p></li>
</ul>
</div>
<div class="section" id="log-exporter">
<h3>Log Exporter<a class="headerlink" href="#log-exporter" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-azure">Azure</a></p></li>
</ul>
</div>
</div>
<div class="section" id="versioning">
<h2>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h2>
<p>This library follows <a class="reference external" href="https://semver.org/">Semantic Versioning</a>.</p>
<p><strong>GA</strong>: Libraries defined at a GA quality level are stable, and will not introduce
backwards-incompatible changes in any minor or patch releases. We will address issues and requests
with the highest priority. If we were to make a backwards-incompatible changes on an API, we will
first mark the existing API as deprecated and keep it for 18 months before removing it.</p>
<p><strong>Beta</strong>: Libraries defined at a Beta quality level are expected to be mostly stable and we're
working towards their release candidate. We will address issues and requests with a higher priority.
There may be backwards incompatible changes in a minor version release, though not in a patch
release. If an element is part of an API that is only meant to be used by exporters or other
opencensus libraries, then there is no deprecation period. Otherwise, we will deprecate it for 18
months before removing it, if possible.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">OPENCENSUS</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">OpenCensus Trace for Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tracing">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extensions">Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#versioning">Versioning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">&lt;no title&gt;</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">&lt;no title&gt;</a></li>
      <li>Next: <a href="api/index.html" title="next chapter">API Documentation</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, OpenCensus Authors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/trace/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>