[tox]
envlist =
  py27-unit

[constants]
unit-base-command = py.test --quiet --cov={envdir}/opencensus --cov=context --cov=contrib --cov-report term-missing --cov-config=.coveragerc --cov-fail-under=90 --ignore=contrib/opencensus-ext-datadog tests/unit/ context/ contrib/

[testenv]
install_command = python -m pip install {opts} {packages}

deps =
  unit: mock==3.0.5
  unit: pytest==4.6.4
  unit: pytest-cov
  unit: retrying
  unit: unittest2
  py27-unit: markupsafe==1.1.1
  unit: -e context/opencensus-context
  unit: -e contrib/opencensus-correlation
  unit: protobuf==3.17.3  #  https://github.com/protocolbuffers/protobuf/issues/8984
  unit: -e .
  unit: -e contrib/opencensus-ext-azure
  unit: -e contrib/opencensus-ext-dbapi
  unit: -e contrib/opencensus-ext-django
  unit: -e contrib/opencensus-ext-flask
  unit: -e contrib/opencensus-ext-gevent
  unit: -e contrib/opencensus-ext-grpc
  unit: -e contrib/opencensus-ext-httplib
  unit: -e contrib/opencensus-ext-jaeger
  unit: -e contrib/opencensus-ext-logging
  unit: -e contrib/opencensus-ext-mysql
  unit: -e contrib/opencensus-ext-ocagent
  unit: -e contrib/opencensus-ext-postgresql
  unit: -e contrib/opencensus-ext-prometheus
  unit: -e contrib/opencensus-ext-pymongo
  unit: -e contrib/opencensus-ext-pymysql
  unit: -e contrib/opencensus-ext-pyramid
  unit: -e contrib/opencensus-ext-requests
  unit: -e contrib/opencensus-ext-sqlalchemy
  unit: -e contrib/opencensus-ext-threading
  unit: -e contrib/opencensus-ext-zipkin
  unit: -e contrib/opencensus-ext-google-cloud-clientlibs

commands =
  py27-unit: {[constants]unit-base-command} --ignore=contrib/opencensus-ext-stackdriver --ignore=contrib/opencensus-ext-flask --ignore=contrib/opencensus-ext-httpx --ignore=contrib/opencensus-ext-fastapi
